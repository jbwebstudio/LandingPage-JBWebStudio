import{DOM,Events,Storage,Logger}from"./utils.js";import{initAnimations,getAnimationManager,AnimationUtils}from"./animations.js";import{initNavigation,getNavigationManager,NavigationUtils}from"./navigation.js";import{initForms,getFormManager}from"./forms.js";const APP_CONFIG={name:"Jorge Blanco Freelance",version:"2.0.0",debug:false,features:{animations:true,navigation:true,forms:true,analytics:false,serviceWorker:false},performance:{lazyLoading:true,imageOptimization:true,prefetchLinks:true}};class App{constructor(){this.isInitialized=false;this.managers={animation:null,navigation:null,form:null};this.features=new Map;this.performanceMetrics={startTime:performance.now(),loadTime:null,initTime:null};this.init()}async init(){try{Logger.log("Iniciando aplicación...",APP_CONFIG);this.checkBrowserSupport();this.setupEnvironment();await this.initializeModules();this.setupFeatures();this.setupPerformanceOptimizations();this.setupErrorHandling();this.isInitialized=true;this.performanceMetrics.initTime=performance.now()-this.performanceMetrics.startTime;Logger.log(`Aplicación inicializada en ${this.performanceMetrics.initTime.toFixed(2)}ms`);this.dispatchEvent("app:initialized")}catch(error){Logger.error("Error al inicializar aplicación:",error);this.handleInitializationError(error)}}checkBrowserSupport(){const requiredFeatures=["Promise","fetch","IntersectionObserver","requestAnimationFrame"];const unsupportedFeatures=requiredFeatures.filter(feature=>{return!window[feature]});if(unsupportedFeatures.length>0){Logger.warn("Características no soportadas:",unsupportedFeatures);this.showBrowserWarning(unsupportedFeatures)}}showBrowserWarning(unsupportedFeatures){const warning=DOM.create("div","browser-warning");warning.innerHTML=`
            <div class="browser-warning-content">
                <h3>Navegador no compatible</h3>
                <p>Tu navegador no soporta algunas características necesarias para el funcionamiento óptimo de este sitio.</p>
                <p>Características no soportadas: ${unsupportedFeatures.join(", ")}</p>
                <p>Por favor, actualiza tu navegador o usa uno más moderno.</p>
                <button class="browser-warning-close">Continuar de todos modos</button>
            </div>
        `;document.body.appendChild(warning);const closeBtn=warning.querySelector(".browser-warning-close");Events.on(closeBtn,"click",()=>{warning.remove()})}setupEnvironment(){if(APP_CONFIG.debug){window.APP=this;window.Logger=Logger;Logger.setLevel("debug")}this.setupCSSVariables();this.setupMetaTags()}setupCSSVariables(){const root=document.documentElement;const setVH=()=>{const vh=window.innerHeight*.01;root.style.setProperty("--vh",`${vh}px`)};setVH();Events.on(window,"resize",Events.throttle(setVH,100));const scrollbarWidth=window.innerWidth-document.documentElement.clientWidth;root.style.setProperty("--scrollbar-width",`${scrollbarWidth}px`);const isTouchDevice="ontouchstart"in window||navigator.maxTouchPoints>0;root.style.setProperty("--is-touch",isTouchDevice?"1":"0");if(isTouchDevice){DOM.addClass(document.body,"touch-device")}}setupMetaTags(){const prefersDark=window.matchMedia("(prefers-color-scheme: dark)").matches;const themeColor=prefersDark?"#0f0f23":"#ffffff";let themeColorMeta=DOM.select('meta[name="theme-color"]');if(!themeColorMeta){themeColorMeta=DOM.create("meta");themeColorMeta.name="theme-color";document.head.appendChild(themeColorMeta)}themeColorMeta.content=themeColor}async initializeModules(){const initPromises=[];if(APP_CONFIG.features.animations){initPromises.push(this.initAnimations())}if(APP_CONFIG.features.navigation){initPromises.push(this.initNavigation())}if(APP_CONFIG.features.forms){initPromises.push(this.initForms())}await Promise.all(initPromises)}async initAnimations(){try{initAnimations();this.managers.animation=getAnimationManager();Logger.log("Módulo de animaciones inicializado")}catch(error){Logger.error("Error al inicializar animaciones:",error)}}async initNavigation(){try{initNavigation();this.managers.navigation=getNavigationManager();Logger.log("Módulo de navegación inicializado")}catch(error){Logger.error("Error al inicializar navegación:",error)}}async initForms(){try{initForms();this.managers.form=getFormManager();Logger.log("Módulo de formularios inicializado")}catch(error){Logger.error("Error al inicializar formularios:",error)}}setupFeatures(){if(APP_CONFIG.performance.lazyLoading){this.setupLazyLoading()}if(APP_CONFIG.performance.prefetchLinks){this.setupLinkPrefetch()}if(APP_CONFIG.features.serviceWorker){this.setupServiceWorker()}if(APP_CONFIG.features.analytics){this.setupAnalytics()}this.setupKeyboardShortcuts();this.setupDarkMode()}setupLazyLoading(){if("IntersectionObserver"in window){const imageObserver=new IntersectionObserver(entries=>{entries.forEach(entry=>{if(entry.isIntersecting){const img=entry.target;const src=img.dataset.src;if(src){img.src=src;img.removeAttribute("data-src");DOM.addClass(img,"loaded");imageObserver.unobserve(img)}}})},{threshold:.1,rootMargin:"50px"});const lazyImages=DOM.selectAll("img[data-src]");lazyImages.forEach(img=>imageObserver.observe(img));this.features.set("lazyLoading",imageObserver)}}setupLinkPrefetch(){const linkObserver=new IntersectionObserver(entries=>{entries.forEach(entry=>{if(entry.isIntersecting){const link=entry.target;const href=link.href;if(href&&!link.dataset.prefetched){this.prefetchLink(href);link.dataset.prefetched="true"}}})},{threshold:.1});const links=DOM.selectAll('a[href^="/"], a[href^="./"]');links.forEach(link=>linkObserver.observe(link));this.features.set("linkPrefetch",linkObserver)}prefetchLink(href){const link=DOM.create("link");link.rel="prefetch";link.href=href;document.head.appendChild(link)}async setupServiceWorker(){if("serviceWorker"in navigator){try{const registration=await navigator.serviceWorker.register("/sw.js");Logger.log("Service Worker registrado:",registration);this.features.set("serviceWorker",registration)}catch(error){Logger.error("Error al registrar Service Worker:",error)}}}setupAnalytics(){Logger.log("Analytics configurado")}setupKeyboardShortcuts(){Events.on(document,"keydown",e=>{if((e.ctrlKey||e.metaKey)&&e.key==="k"){e.preventDefault();this.openSearch()}if(e.key==="Escape"){this.closeModals()}if(e.altKey&&e.key==="h"){e.preventDefault();this.goToHome()}})}setupDarkMode(){const darkModeToggle=DOM.select(".dark-mode-toggle");if(darkModeToggle){Events.on(darkModeToggle,"click",()=>{this.toggleDarkMode()})}const prefersDark=window.matchMedia("(prefers-color-scheme: dark)");Events.on(prefersDark,"change",e=>{if(!Storage.get("darkMode")){this.setDarkMode(e.matches)}});const savedDarkMode=Storage.get("darkMode");if(savedDarkMode!==null){this.setDarkMode(savedDarkMode)}else if(prefersDark.matches){this.setDarkMode(true)}}toggleDarkMode(){const isDark=DOM.hasClass(document.body,"dark-mode");this.setDarkMode(!isDark)}setDarkMode(isDark){if(isDark){DOM.addClass(document.body,"dark-mode")}else{DOM.removeClass(document.body,"dark-mode")}Storage.set("darkMode",isDark);const themeColorMeta=DOM.select('meta[name="theme-color"]');if(themeColorMeta){themeColorMeta.content=isDark?"#0f0f23":"#ffffff"}}setupPerformanceOptimizations(){this.optimizeScrollPerformance();this.optimizeResizePerformance();this.preloadCriticalResources()}optimizeScrollPerformance(){let ticking=false;const optimizedScroll=()=>{ticking=false};Events.on(window,"scroll",()=>{if(!ticking){requestAnimationFrame(optimizedScroll);ticking=true}},{passive:true})}optimizeResizePerformance(){Events.on(window,"resize",Events.debounce(()=>{this.setupCSSVariables();this.dispatchEvent("app:resize")},250))}preloadCriticalResources(){const criticalResources=[];criticalResources.forEach(url=>{const link=DOM.create("link");link.rel="preload";link.href=url;link.as=this.getResourceType(url);document.head.appendChild(link)})}getResourceType(url){const extension=url.split(".").pop().toLowerCase();const typeMap={css:"style",js:"script",woff:"font",woff2:"font",jpg:"image",jpeg:"image",png:"image",webp:"image",svg:"image"};return typeMap[extension]||"fetch"}setupErrorHandling(){Events.on(window,"error",e=>{Logger.error("Error de JavaScript:",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,error:e.error})});Events.on(window,"unhandledrejection",e=>{Logger.error("Promesa rechazada:",e.reason)});Events.on(window,"error",e=>{if(e.target!==window){Logger.error("Error de recurso:",{element:e.target.tagName,source:e.target.src||e.target.href,message:"Failed to load resource"})}},true)}handleInitializationError(error){const errorMessage=DOM.create("div","initialization-error");errorMessage.innerHTML=`
            <div class="error-content">
                <h2>Error de inicialización</h2>
                <p>Ha ocurrido un error al cargar la aplicación.</p>
                <button class="retry-button">Reintentar</button>
            </div>
        `;document.body.appendChild(errorMessage);const retryButton=errorMessage.querySelector(".retry-button");Events.on(retryButton,"click",()=>{location.reload()})}openSearch(){Logger.log("Abrir búsqueda")}closeModals(){const modals=DOM.selectAll(".modal.show, .overlay.show");modals.forEach(modal=>{DOM.removeClass(modal,"show")})}goToHome(){if(this.managers.navigation){this.managers.navigation.navigateToSection("hero")}else{window.scrollTo({top:0,behavior:"smooth"})}}dispatchEvent(eventName,detail={}){const event=new CustomEvent(eventName,{detail:{...detail,app:this}});document.dispatchEvent(event)}getManager(name){return this.managers[name]}getFeature(name){return this.features.get(name)}getPerformanceMetrics(){return{...this.performanceMetrics,currentTime:performance.now()-this.performanceMetrics.startTime}}destroy(){Object.values(this.managers).forEach(manager=>{if(manager&&typeof manager.destroy==="function"){manager.destroy()}});this.features.forEach(feature=>{if(feature&&typeof feature.disconnect==="function"){feature.disconnect()}});Events.removeAll();Logger.log("Aplicación destruida")}}let app=null;const initApp=()=>{if(document.readyState==="loading"){Events.on(document,"DOMContentLoaded",()=>{app=new App})}else{app=new App}};Events.on(window,"load",()=>{if(app){app.performanceMetrics.loadTime=performance.now()-app.performanceMetrics.startTime;Logger.log(`Página cargada en ${app.performanceMetrics.loadTime.toFixed(2)}ms`);app.dispatchEvent("app:loaded")}});initApp();window.App=app;export default{App:App,APP_CONFIG:APP_CONFIG,getApp:()=>app};let currentTestimonial=0;const testimonials=document.querySelectorAll(".testimonial-card");const totalTestimonials=testimonials.length;const container=document.getElementById("testimonialsContainer");const dots=document.querySelectorAll(".pagination-dot");function updateTestimonialSlider(){if(container){container.style.transform=`translateX(-${currentTestimonial*100}%)`;dots.forEach((dot,index)=>{dot.classList.toggle("active",index===currentTestimonial)});const prevBtn=document.querySelector(".prev-btn");const nextBtn=document.querySelector(".next-btn");if(prevBtn)prevBtn.disabled=currentTestimonial===0;if(nextBtn)nextBtn.disabled=currentTestimonial===totalTestimonials-1}}function nextTestimonial(){if(currentTestimonial<totalTestimonials-1){currentTestimonial++;updateTestimonialSlider()}}function previousTestimonial(){if(currentTestimonial>0){currentTestimonial--;updateTestimonialSlider()}}function goToTestimonial(index){currentTestimonial=index;updateTestimonialSlider()}let testimonialInterval;function startTestimonialAutoplay(){testimonialInterval=setInterval(()=>{if(currentTestimonial<totalTestimonials-1){nextTestimonial()}else{currentTestimonial=0;updateTestimonialSlider()}},5e3)}function stopTestimonialAutoplay(){clearInterval(testimonialInterval)}document.addEventListener("DOMContentLoaded",function(){updateTestimonialSlider();startTestimonialAutoplay();const testimonialsSection=document.querySelector(".testimonials-slider");if(testimonialsSection){testimonialsSection.addEventListener("mouseenter",stopTestimonialAutoplay);testimonialsSection.addEventListener("mouseleave",startTestimonialAutoplay)}});